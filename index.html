<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>LAB 4 Robin o Jonathan</title>

    <script>
        window.addEventListener("load", function() {

            let ajaxKey = new XMLHttpRequest(); // NEW AJAX REQUEST

            let btn = document.getElementById("key"); //HÄMTA GET KEY KNAPPEN

            let output = document.getElementById("output")
            let inputKey = document.getElementById("keyin");

            //Lägga till bok
            let ajaxAdd = new XMLHttpRequest(); // NEW AJAX REQUEST (EJ NÖDVÄNDIG)
            let addBook = document.getElementById("addBook");
            let title = document.getElementById("title");
            let author = document.getElementById("author");
            let addBookStatus = document.getElementById("addBookStatus");

            //Kolla på böcker
            let viewBooks = document.getElementById("viewBooks");
            let ulList = document.getElementsByTagName("ul");


            addBook.addEventListener("click", function() {
                ajaxAdd.onreadystatechange = function() {
                    if (ajaxAdd.readyState === 4) {
                        let json = JSON.parse(ajaxAdd.responseText);
                        console.log(json)
                        console.log(ajaxAdd.id);
                        console.log(ajaxAdd.status);
                        console.log(inputKey.value)
                        console.log(title.value)
                        console.log(author.value)

                        addBookStatus.innerHTML = `Status: ${json.status}<br>
                    Book ID: ${json.id}`
                    }
                };
                ajaxAdd.open("get", `https://www.forverkliga.se/JavaScript/api/crud.php?op=insert&key=${inputKey.value}&title=${title.value}&author=${author.value}`)
                ajaxAdd.send();
            });

            //KOLLA LISTAN - TWEAK NEEDED!! klickar man två gånger ska samma lista komma upp
            viewBooks.addEventListener("click", function() {
                ajaxAdd.onreadystatechange = function() {
                    if (ajaxAdd.readyState === 4) {
                        let json = JSON.parse(ajaxAdd.responseText);
                        console.log(json);

                        for (let i = 0; i < json.data.length; i++) {
                            console.log(json.data[i]);
                            let addLi = document.createElement("li");
                            addLi.innerHTML += `Title: <strong>${json.data[i].title}</strong><br>`;
                            addLi.innerHTML += `Author: <strong>${json.data[i].author}</strong><br>`;
                            addLi.innerHTML += `Book ID: <strong>${json.data[i].id}</strong><br>`;
                            addLi.innerHTML += `Last Update: <strong>${json.data[i].updated}</strong><br>`;
                            ulList[0].appendChild(addLi);
                        }

                    }

                }
                ajaxAdd.open("get", `https://www.forverkliga.se/JavaScript/api/crud.php?op=select&key=${inputKey.value}`)
                ajaxAdd.send()
            });


            btn.addEventListener("click", function(e) { // KLICKA PÅ KNAPP GET KEY
                ajaxKey.onreadystatechange = function() {
                    if (ajaxKey.readyState === 4) {
                        let json = JSON.parse(ajaxKey.responseText);
                        inputKey.value = json.key
                    }
                }
                ajaxKey.open("get", "https://www.forverkliga.se/JavaScript/api/crud.php?requestKey")
                ajaxKey.send()
            });
        });

    </script>

    <style>
        body {}

        button {
            padding: 10px;
            color: white;
            margin: 10px;
            box-shadow: 5px 5px 10px;
            background: #b95c69;
        }

        input {
            padding: 5px;
            font-family: arial;
            margin: 5px;
        }

        ul {
            background: rgb(159, 159, 159);
            width: 250px;
            height: 300px;
            box-shadow: 2px 2px 5px black;
        }

    </style>
</head>

<body>

    <button id="key">Get Key</button>
    <br>
    <input type="text" placeholder="Key" name="" id="keyin"> <br>
    <input type="text" placeholder="Title" name="" id="title"><br>
    <input type="text" placeholder="Author" name="" id="author"><br>

    <button id="addBook">Add Book</button>
    <div id="addBookStatus"></div>

    <ul>
    </ul>

    <button id="viewBooks">View Books</button>
    <button id="changeBook">Change Book</button><br>
    <input type="text" placeholder="Id" name="" id="id"> <br>
    <input type="text" placeholder="Title" name="" id="title"><br>
    <input type="text" placeholder="Author" name="" id="author"><br>

    <button id="changeBook">Delete Book</button><br>
    <input type="text" placeholder="Delete Id" id="deleteId">


</body>

</html>
